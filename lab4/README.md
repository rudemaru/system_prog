# Лабораторная работа No 4. Задача производители-потребители для процессов

Основной процесс создает очередь сообщений, после чего ожидает и обрабатывает нажа-
тия клавиш, порождая и завершая процессы двух типов —производители и потребители.

Очередь сообщений представляет собой классическую структуру — кольцевой буфер, со-
держащий указатели на сообщения, и пара указателей на голову и хвост. Помимо этого очередь
содержит счетчик добавленных сообщений и счетчик извлеченных.

Производители формируют сообщения и, если в очереди есть место, перемещают их туда.
Потребители, если в очереди есть сообщения, извлекают их оттуда, обрабатывают и осво-
бождают память с ними связанную.

Для работы используются два семафора для заполнения и извлечения, а также мьютекс
или одноместный семафор для монопольного доступа к очереди.

Производители генерируют сообщения, используя системный генератор rand(3) для size и
data. В качестве результата для size используется остаток от деления на 257.
Если остаток от деления равен нулю, rand(3) вызывается повторно. Если остаток от деле-
ния равен 256, значение size устанавливается равным 0, реальная длина сообщения при этом со-
ставляет 256 байт.

При формировании сообщения контрольные данные формируются из всех байт сообще-
ния. Значение поля hash при вычислении контрольных данных принимается равным нулю. Для
расчета контрольных данных можно использовать любой подходящий алгоритм на выбор сту-
дента.

После помещения значения в очередь перед освобождением мьютекса очереди производи-
тель инкрементирует счетчик добавленных сообщений. Затем после поднятия семафора выво-
дит строку на stdout, содержащую помимо всего новое значение этого счетчика.
Потребитель, получив доступ к очереди, извлекает сообщение и удаляет его из очереди.

Перед освобождением мьютекса очереди инкрементирует счетчик извлеченных сообщений. За-
тем после поднятия семафора проверяет контрольные данные и выводит строку на stdout, со-
держащую помимо всего новое значение счетчика извлеченных сообщений.

При получении сигнала о завершении процесс должен завершить свой цикл и только по-
сле этого завершиться, не входя в новый.
Следует предусмотреть задержки, чтобы вывод можно было успеть прочитать в процессе
работы программы.

Следует предусмотреть защиту от тупиковых ситуаций из-за отсутствия производителей
или потребителей.
